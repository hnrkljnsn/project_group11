<div th:fragment="navbar">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.3/css/all.min.css">
  <div class="navigationBar">
    <div class="left-items">
      <a href="home.html">Flight<br>Finder</a>
    </div>
    <div class="middle-items">
      <a class="active nav-link" href="home.html">Home</a>
      <a class="nav-link" href="about.html">About</a>
      <a class="nav-link" href="search.html">Search</a>
    </div>
    <div class="right-items">
      <a href="#" id="userIcon"><i class="fas fa-user"></i></a>
      <a href="#" id="logoutButton" style="display: none;">Logout</a>
    </div>
  </div>
  <script>
    document.addEventListener('DOMContentLoaded', function() {
      const userIcon = document.getElementById('userIcon');
      const logoutButton = document.getElementById('logoutButton');
      const token = localStorage.getItem('token');
      const userId = new URLSearchParams(window.location.search).get('userId');

      if (token) {
        logoutButton.style.display = 'block';
      } else {
        logoutButton.style.display = 'none';
      }

      if (userIcon) {
        userIcon.addEventListener('click', function() {
          if (token) {
            window.location.href = `favorites.html?userId=${userId}`;
          } else {
            window.location.href = 'login.html';
          }
        });
      }

      if (logoutButton) {
        logoutButton.addEventListener('click', function() {
          localStorage.removeItem('token');
          window.location.href = 'login.html';
        });
      }

      // Append userId to all internal navigation links
      const navLinks = document.querySelectorAll('.nav-link');
      navLinks.forEach(link => {
        const url = new URL(link.href, window.location.origin); // Ensure full URL
        if (userId) {
          url.searchParams.set('userId', userId);
        }
        link.href = url.toString();
      });
    });
  </script>
</div>
